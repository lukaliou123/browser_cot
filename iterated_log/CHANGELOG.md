# 更新日志 (Changelog)

## [迭代 V1] - 2024-05-16

本次迭代主要围绕 PRD "思维链分割与管理 V1" 展开，实现了以下核心功能，旨在提升用户对思维链的组织和管理能力。

### ✨ 新增功能 (Features)

1.  **手动分割思维链 (PRD 3.1)**
    *   用户现在可以在可视化界面通过 "开始新链" 按钮主动结束当前思维链，并开启一个新的思维链进行记录。

2.  **思维链命名机制 (PRD 3.2)**
    *   **默认命名 (PRD 3.2.1):** 新创建的思维链（无论是手动还是自动分割）会自动获得一个基于当前日期的默认名称，格式为 "YYYY-MM-DD"。如果当天已存在同名链，则追加序号，如 "YYYY-MM-DD (2)"。
    *   **用户编辑命名 (PRD 3.2.2):** 用户现在可以通过可视化界面中的 "编辑名称" 按钮修改任何已存在思维链的名称。

3.  **按天自动分割思维链 (PRD 3.3)**
    *   插件现在会设置一个每日定时器，在凌晨4:00自动检查。如果前一个"工作日"（至当天4:00前）存在活动的思维链，系统会自动将其归档（逻辑上，即不再是活动链），并为新的"工作日"创建一个以当天日期命名的新思维链作为活动链。
    *   需要在 `manifest.json` 中添加了 `"alarms"` 权限。

4.  **删除思维链 (补充需求)**
    *   用户现在可以通过可视化界面中的 "删除链" 按钮删除选定的思维链。
    *   删除操作前会有二次确认提示。
    *   如果被删除的是活动链，系统会自动尝试激活剩余链中的一个（通常是列表中的第一个）或将活动状态置空。

### 🛠️ 技术实现与改进

*   **`js/storage.js`**:
    *   新增 `generateNewChainName()` 方法用于生成符合规则的默认链名称。
    *   新增 `updateChainName()` 方法用于更新指定链的名称。
    *   利用并验证了已有的 `deleteChain()` 方法。
*   **`background.js`**:
    *   为上述所有新功能添加了相应的消息处理器 (`handleManualSplitChain`, `handleUpdateChainName`, `handleDeleteChain`)。
    *   实现了 `setupDailySplitAlarm()` 和 `handleDailyChainSplit()` 方法，使用 `chrome.alarms` API 管理每日自动分割任务。
*   **`visualize.html` / `visualize.js`**:
    *   添加了对应的UI按钮（开始新链、编辑名称、删除链）。
    *   实现了与 `background.js` 的消息通信，以及在操作成功后刷新UI（思维链列表、可视化视图）的逻辑。

### 📝 PRD 参考
*   本次迭代主要依据 `./iterated_log/PRD_思维链分割与管理_V1.md` 进行开发。 